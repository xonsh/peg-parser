> [!WARNING]
> The development to use `pegen for Xonsh` is halted mostly because of the following reasons.
> - The development activity on [pegen](https://github.com/we-like-parsers/pegen) has slowed down. Recent Python versions have significant grammar changes; If pegen provides the Python specific changes, then it can be reused without much maintenance burden. Other option is to copy grammar from [CPython](https://github.com/python/cpython/blob/main/Tools/peg_generator/) repo itself and transpile the `C` code to Python
> - I have heavily modified the original [Python generator](https://github.com/xonsh/peg-parser/tree/main/pegen) to reduce the amount of code generated. Even though the memory usage has been reduced for small files, the performance wasn't upto the mark. So I've decided to focus on [reusing Ruff's parser](https://github.com/jnoortheen/xonsh-rd-parser/).
>
> <cite>â€”- Noortheen Raja J</cite>

# xonsh-parser

<p align="center">
    <em>Xonsh parser using CPython's PEGen grammar</em>
</p>

[![build](https://github.com/jnoortheen/xonsh-parser/workflows/Build/badge.svg)](https://github.com/jnoortheen/xonsh-parser/actions)
[![codecov](https://codecov.io/gh/jnoortheen/xonsh-parser/branch/master/graph/badge.svg)](https://codecov.io/gh/jnoortheen/xonsh-parser)
[![PyPI version](https://badge.fury.io/py/xonsh-parser.svg)](https://badge.fury.io/py/xonsh-parser)

---

**Documentation**: <a href="https://jnoortheen.github.io/xonsh-parser/" target="_blank">https://jnoortheen.github.io/xonsh-parser/</a>

**Source Code**: <a href="https://github.com/jnoortheen/xonsh-parser" target="_blank">https://github.com/jnoortheen/xonsh-parser</a>

**Benchmarks**: https://xonsh.github.io/peg-parser/dev/bench/

---

## Development

### Setup environment

- You can use any PEP-621 supported tools like [PDM](https://pdm-project.org/en/latest/), [Hatch](https://hatch.pypa.io/latest/install/) ... to manage the development environment and production build.

```sh
# install development deps
uv sync
```

- We use [pre-commit](https://pre-commit.com/) for linting the code.

```sh
# setup linters,formatters etc.,
pre-commit install
```

- We use [Taskfile](https://taskfile.dev/usage/) to manage development tasks.
```bash
task test

# to watch for changes and run tests
task test --watch -- -x --ff

# release a new version
task release
```

### Workflow

1. Explore the PEG grammar notations from the following pages
 a. https://we-like-parsers.github.io/pegen/
 b. https://devguide.python.org/internals/parser/
2. Edit the [xonsh.gram](./tasks/xonsh.gram) while adding any new actions to [subheader.py](./peg_parser/subheader.py)
3. Test the new changes with `task test` as the [parser.py](./peg_parser/parser.py) will get autogenerated
4. You can force regeneration with `task generate -f`


## License

This project is licensed under the terms of the MIT license.

## Credits

- Thanks to [pegen](https://github.com/we-like-parsers/pegen) project for the Python version of the `CPython's` PEG parser
- Thanks to [intellij-pegen-plugin](https://github.com/vpoverennov/pegen-plugin)
